<html>
<head>
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Cache-Control" content="no-cache">   
<script type="text/javascript" language="javaScript" src="https://ymqui.github.io/photo/script/error.js">           </SCRIPT>
<script type="text/javascript" language="javaScript" src="https://ymqui.github.io/photo/info/index_birds_orders.js"></SCRIPT>
<script type="text/javascript" language="javaScript" src="https://ymqui.github.io/photo/info/index_birds_names.js"> </SCRIPT>
<script type="text/javascript" language="javaScript" src="https://ymqui.github.io/photo/info/stat.js">              </SCRIPT>
<style>
.center{
   margin-left: auto;
   margin-right:auto;
}
.pic{
   position: relative;
   width: 100%;
   max-width: 900px;
}
</style>
</head>
<body>
<script type="text/javascript" language="javaScript">
<!--
//chinese name for countries
//flags https://www.worldometers.info/geography/flags-of-the-world/
var eng_chn = [["Argentina","阿根廷"],["Australia","澳大利亚"],["Bahamas","巴哈马"],["Belize","伯利兹"],["Brazil","巴西"],["Cambodia","柬埔寨"],["Canada","加拿大"],["Chile","智利"],["China","中国"],["Congo","刚果"],["Costa Rica","哥斯达黎加"],
               ["Cuba","古巴"],["Denmark","丹麦"],["Egypt","埃及"],["Ethiopia","埃塞俄比亚"],["Fiji","斐济"],["France","法国"],["Germany","德国"],["Greece","希腊"],["Iceland","冰岛"],["India","印度"],["Italy","意大利"],["Jamaica","牙买加"],
               ["Japan","日本"],["Kenya","肯尼亚"],["Madagascar","马达加斯加"],["Malaysia","马来西亚"],["Mexico","墨西哥"],["Nepal","尼泊尔"],["New Zealand","新西兰"],["Norway","挪威"],["Panama","巴拿马"],["Papua New Guinea","巴布亚新几内亚"],
               ["Peru","秘鲁"],["Singapore","新加坡"],["South Africa","南非"],["South Korea","韩国"],["Spain","西班牙"],["Tanzania","坦桑尼亚"],["Thailand","泰国"],["United Kingdom", "英国"],["USA","美国"]];
var eng_cou = getColumn(eng_chn,0);
var chn_cou = getColumn(eng_chn,1);

var links = [ebird('Maryland'),ebird('Virginia'),ebird('Delaware'),ebird('Pennsylvania'),ebird('New York'),ebird('New Jersey'),ebird('West Virginia'),
             '<a href="https://ebird.org/map" target="link5">'+mytext((['Species Map','鸟类分布地图'])[cn_ind])+'</a>',
             '<a href="https://ebird.org/hotspots" target="link6">'+mytext((['Hotspots Map','观鸟热点地图'])[cn_ind])+'</a>',
             '<a href="https://groups.google.com/g/mdbirding" target="link7">'+mytext((['MDBirding-Google Group','美国马里兰州Google观鸟群'])[cn_ind])+'</a>',
             '<a href="https://www.facebook.com/groups/MDRareBirdsDiscussionGroup/" target="link8">'+mytext((['MD Facebook Notable Sightings Group','美国马里兰州Facebook观鸟群'])[cn_ind])+'</a>',
             '<a href="https://www.facebook.com/groups/118655321826890/" target="link9">'+mytext((['VA Facebook Notable Sightings Group','美国弗吉尼亚州Facebook观鸟群'])[cn_ind])+'</a>',
             '<a href="https://www.aba.org/aba-checklist/" target="link10">'+mytext((['ABA Checklist','ABA鸟类清单'])[cn_ind])+'</a>',
             '<a href="https://www.aba.org/birding-news/" target="link11">'+mytext((['ABA Birding News','ABA观鸟新闻'])[cn_ind])+'</a>',
             '<a href="https://www.allaboutbirds.org/guide/browse/taxonomy/Parulidae" target="link12">'+mytext((['New World Warbler Songs','北美森莺鸣声鉴别'])[cn_ind])+'</a>',
             '<a href="https://drive.google.com/file/d/1H0vaHGGroxPiH6FvUH8616ml7r34XcbH/view?usp=sharing" target="link13">'+mytext((['Warbler Guide Quick Finders','北美森莺鉴别快速指南'])[cn_ind])+'</a>'];
var icons = ['https://ymqui.github.io/photo/thumbnail/ebird.png',
	     'https://ymqui.github.io/photo/thumbnail/groups.png',
	     'https://ymqui.github.io/photo/thumbnail/facebook.ico',
	     'https://ymqui.github.io/photo/thumbnail/facebook.ico',
	     'https://ymqui.github.io/photo/thumbnail/aba.png',
	     'https://ymqui.github.io/photo/thumbnail/aba.png',
	     'https://ymqui.github.io/photo/thumbnail/cornell.png',
	     'https://ymqui.github.io/photo/thumbnail/cornell.png'];
var date = new Date();
if (date.getTimezoneOffset()/60 ==(-8)){ //in China
    links.unshift(ebird('Fujian'),ebird('Zhejiang'),ebird('Beijing'),ebird('Shanghai'));
}
//icons at the beginning of the list are all ebird
while (icons.length<links.length){
      icons.unshift(icons[0]);
}

function ebird(name){
    var alerts = { Arizona:             ['35601','美国亚利桑那州'],
		   Beijing:             ['39713','中国北京'],
                   California:    	['35464','美国加利福尼亚州'],
		   Delaware: 		['35547','美国特拉华州'],
                   Florida:             ['35579','美国佛罗里达州'],
		   Fujian:              ['55849','中国福建省'],
		   HongKong:            ['38532','香港'],
		   Maryland: 		['35550','美国马里兰州'],
                   Michigan:            ['35641','美国密歇根州'],
                   Nevada:     	       	['35528','美国内华达州'],
                   NewJersey:          	['35544','美国新泽西州'],
                   NewYork:           	['35466','美国纽约州'],
                   Ohio:          	['35533','美国俄亥俄州'],
                   Ontario:          	['35610','加拿大安大略省'],
                   Oregon:          	['35555','美国俄勒冈州'],
		   Pennsylvania: 	['35546','美国宾夕法尼亚州'],
		   Shanghai:            ['45783','中国上海'],
                   Virginia: 		['35646','美国弗吉尼亚州'],
                   Washington:    	['35602','美国华盛顿州'],
                   WestVirginia:    	['35684','美国西弗吉尼亚州'],
                   Zhejiang:            ['42133','中国浙江省']
                 };
    var id = alerts[name.replace(/\s/g, "")];
    if (is_chinese){
       return '<a href="https://ebird.org/alert/summary?sid=SN'+id[0]+'&sortBy=obsDt&o=desc" target="link0">'+mytext(id[1]+'稀有鸟类警报')+'</a>';
    }else{
       return '<a href="https://ebird.org/alert/summary?sid=SN'+id[0]+'&sortBy=obsDt&o=desc" target="link0">'+mytext(name+' Rare Bird Alert')+'</a>';
    }
}

function sortProperties(obj,byname){
    // convert object into array
    var sortable=[];
    for(var key in obj){
        if(obj.hasOwnProperty(key)){
            sortable.push([key, obj[key]]); // each item is an array in format [key, value]
        }
    }
    // sort items by value
    sortable.sort(function(a, b)
    { if ((a[1]!==b[1]) && !byname){
         return a[1]-b[1]; // compare numbers
      }else{
         return (a[0]).localeCompare(b[0]);
      }
    });
    return sortable; // array in format [ [ key1, val1 ], [ key2, val2 ], ... ]
}

function mytext(text,col){   
    var fsize = '<font';
    if (cellphone) {fsize='<font size="+1"';}
    if(typeof col === 'undefined'){
       return fsize+'><strong>'+text+'</strong></font>';
    }else{
       return fsize+' color="'+col+'"><strong>'+text+'</strong></font>';
    }
}

function getCountry(str,offset){
    if (str.length==0){return '';}
    if (str.match(/,/)){
       var tmp = str.split(/ *, */);
       return tmp[tmp.length-offset];
    }else{
       return str;
    }
}

function getlocFlag(str){
    var tmp = locurl[str];
    if (tmp[2].match(/[\u3400-\u9FBF]/)){
       return getFlag(getCountry(tmp[1],1));
    }else{
       return getFlag(getCountry(tmp[2],1));
    }
}

function getFlag(country){
    var tmp = (['arb','arb1'])[Math.round(Math.random())];
    if (typeof country != 'undefined'){
       if (country.length>0){ 
          tmp = country;
          if (tmp.match(/[\u3400-\u9FBF]/)) {
             tmp = eng_cou[chn_cou.indexOf(tmp)];
          }
          tmp = tmp.replace(/\s/g, "");
       }else{
          country = (["List of countries and dependencies by area","世界各国"])[cn_ind];
       }
    }else{
       country = (["List of countries and dependencies by area","世界各国"])[cn_ind];
    }
    if (is_chinese) {
       return '<a href="'+baikeurl(country)+'" style="text-decoration:none" target="country"><img src="https://ymqui.github.io/photo/thumbnail2/'+tmp.toLowerCase()+'.gif" style="width:20px;height:auto;position:relative;top:1px;"></a>&nbsp;&nbsp;';
    }else{
       return '<a href="'+wikiurl(country)+'" style="text-decoration:none" target="country"><img src="https://ymqui.github.io/photo/thumbnail2/'+tmp.toLowerCase()+'.gif" style="width:20px;height:auto;position:relative;top:1px;"></a>&nbsp;&nbsp;';
    }
}

function getColumn(anArray, columnNumber) {
    return anArray.map(function(row) {
        return row[columnNumber];
    });
}

//count countries
var cou_cnts  = {};
var ocnts = 0;
var otot = orders.length;
var ftot = 0;
const unique = (value, index, self) => {
      return self.indexOf(value) === index;
}
var fcnts = (birds.map(({family})=>family).filter(unique)).length;
for(var i=0;i<orders.length;i++){
    var ordercnt = 0;
    ftot = ftot+orders[i].family.length;
    for(var j=0;j<orders[i].family.length;j++){
         tmp0 = getByFamily(orders[i].family[j].name, birds);
         if (tmp0.length==0) continue;
         ordercnt = 1;
    }
    if (ordercnt!=0){ocnts++;}
}     
for (var i=0;i<birds.length;i++){
    var tmp_cnts = {};
    for (var j=0;j<birds[i].info.length;j++){
        var tmp2 = getCountry(birds[i].info[j],2);
        if (is_chinese) {
           tmp2 = chn_cou[eng_cou.indexOf(tmp2)];
        }
        if (typeof cou_cnts[tmp2] ==='undefined') cou_cnts[tmp2] = 0;
        if (typeof tmp_cnts[tmp2] ==='undefined') tmp_cnts[tmp2] = 0;
        if (tmp_cnts[tmp2]==0){
           cou_cnts[tmp2]++;
           tmp_cnts[tmp2]++;
        }
    }
}
cou_cnts = sortProperties(cou_cnts,([true,false])[cn_ind]);

var fcol1 = '#000080';
var fcol2 = '#0000A0';
var fcol3 = 'green';

var tot_bird = '<a href="'+blnk+'" style="text-decoration:none; color:'+fcol3+';" target="linktotb">'+mytext('/'+btot.toString(),fcol3)+'</a>';
var tot_coun = '<a href="'+clnk+'" style="text-decoration:none; color:'+fcol3+';" target="linktotc">'+mytext('/'+ctot.toString(),fcol3)+'</a>';
var tot_bord = '<a href="'+blnk+'" style="text-decoration:none; color:'+fcol3+';" target="linktoto">'+mytext('/'+otot.toString(),fcol3)+'</a>';
var tot_bfam = '<a href="'+blnk+'" style="text-decoration:none; color:'+fcol3+';" target="linktotf">'+mytext('/'+ftot.toString(),fcol3)+'</a>';

//check to see if any of the locations has little or no use
var tmp = Object.keys(locurl);
var tmp1 = Object.keys(py);
for (var i=0;i<tmp1.length;i++){
    if (typeof py_cnts[tmp1[i]] === 'undefined') py_cnts[tmp1[i]] = 0;
}
py_cnts = sortProperties(py_cnts);
for (var i=0;i<tmp.length;i++){
    if (typeof loc_cnts[tmp[i]] === 'undefined') loc_cnts[tmp[i]] = 0;
}

loc_cnts = sortProperties(loc_cnts);

document.write('<table class="center">');
document.write('<tr><td colspan="9">');
document.write('<a href="https://ymqui.github.io/'+(['photo','zhaopian'])[cn_ind]+'/birds/showbird.html?order" target="LaoQ"><img src="https://ymqui.github.io/photo/thumbnail/'+(["lifer_stat.png","lifer_stat_cn.png"])[cn_ind]+'" class="pic"></a>');
document.write('</td></tr><tr><td><small>&emsp;</small></td><td>&emsp;</td></tr><tr>');
document.write('<td align="left">'+mytext((['Total Bird Species','鸟类总数'])[cn_ind]+':&emsp;',fcol1)+'</td><td align="right">'+mytext(birds.length.toString(),fcol2)+tot_bird+'</td>');
document.write('<td>&emsp;&emsp;</td>');
document.write('<td align="left">'+mytext((['Total Bird Orders','鸟目总数'])[cn_ind]+':&emsp;',fcol1)+'</td><td align="right">'+mytext(ocnts.toString(),fcol2)+tot_bord+'</td>');
document.write('<td>&emsp;&emsp;</td>');
document.write('<td align="left">'+mytext((['Total Bird Families','鸟科总数'])[cn_ind]+':&emsp;',fcol1)+'</td><td align="right">'+mytext(fcnts.toString(),fcol2)+tot_bfam+'</td>');
document.write('</tr><tr><td><small>&emsp;</small></td><td>&emsp;</td></tr><tr>');
document.write('<td align="left">'+mytext((['Total Bird Photos','照片总数'])[cn_ind]+':&emsp;',fcol1)+'</td><td align="right">'+mytext(pic_cnts.toString(),fcol2)+'</td>');
document.write('<td>&emsp;&emsp;</td>');
document.write('<td align="left">'+mytext((['Total Misc Bird Photos','misc照片总数'])[cn_ind]+':&emsp;',fcol1)+'</td><td align="right">'+mytext(misc_cnts.toString(),fcol2)+'</td>');
document.write('</tr><tr><td><small>&emsp;</small></td><td>&emsp;</td></tr><tr>');
document.write('<td align="left">'+mytext((['Total Locations','地址总数'])[cn_ind]+':&emsp;',fcol1)+'</td><td align="right">'+mytext(tmp.length.toString(),fcol2)+'</td>');
document.write('<td>&emsp;&emsp;</td>');
document.write('<td align="left">'+mytext((['Total Countries','国家总数'])[cn_ind]+':&emsp;',fcol1)+'</td><td align="right">'+mytext(cou_cnts.length.toString(),fcol2)+tot_coun+'</td>');
document.write('<td>&emsp;&emsp;</td>');
document.write('<td colspan="3" align="left">'+mytext((['Bookmarks','观鸟链接(<a href="stat.html" style="text-decoration:none;color:'+fcol1+'">英文</a>网站)'])[cn_ind]+':',fcol1)+'</td></tr>');
var i = 0;
var j = 0;
var k = 0;
var clen = 10;
while((i<loc_cnts.length) || (j<cou_cnts.length+py_cnts.length+2) || (k<(links.length*2-1))){
    document.write('<tr>');
    if (i<loc_cnts.length){
       var txcol1 = ' style="color: '+(['red','orange','blue'])[Math.min(2,loc_cnts[i][1])]+'">';
       var txcol2 = ' style="text-decoration:none; color: '+(['red','orange','blue'])[Math.min(2,loc_cnts[i][1])]+'">';
       tmp_url = '';
       if (locurl[loc_cnts[i][0]].length>6){
          if (locurl[loc_cnts[i][0]][6].match(/[\u3400-\u9FBF]/)||(!is_chinese)||((locurl[loc_cnts[i][0]].length>7) && is_chinese)){
             tmp_url = locurl[loc_cnts[i][0]][Math.min(6+cn_ind,locurl[loc_cnts[i][0]].length-1)];
          }
       }else if (locurl[loc_cnts[i][0]].length>4){
          if (locurl[loc_cnts[i][0]][4].match(/[\u3400-\u9FBF]/)||(!is_chinese)||((locurl[loc_cnts[i][0]].length>5) && is_chinese)){
             tmp_url = locurl[loc_cnts[i][0]][Math.min(4+cn_ind,locurl[loc_cnts[i][0]].length-1)];
          }
       }
       if (tmp_url.length>0){
          tmp_url = getlocFlag(loc_cnts[i][0])+'<a href="'+tmp_url+'" target="'+loc_cnts[i][0]+'"'+txcol1+loc_cnts[i][0]+'</a>';
       }else {
          tmp_url = getlocFlag(loc_cnts[i][0])+loc_cnts[i][0];
       }
       var loc_url = loc_cnts[i][1].toString();
       if (loc_cnts[i][1]>0) {
           loc_url = '<a href="https://ymqui.github.io/'+(['photo','zhaopian'])[cn_ind]+'/birds/showbird.html?order&loc='+loc_cnts[i][0]+'" target="'+loc_cnts[i][0]+'"'+txcol2+loc_url+'</a>';
       }
       document.write('<td align="left"'+txcol1+tmp_url+'</td><td align="right"'+txcol1+loc_url+'</td>');
    }else{
       document.write('<td></td><td></td>');
    }
    i++;
    document.write('<td></td>');
    if (j<cou_cnts.length){
       document.write('<td align="left">'+getFlag(cou_cnts[j][0])+'<a href="https://ymqui.github.io/'+(['photo','zhaopian'])[cn_ind]+'/birds/showbird.html?order&country='+cou_cnts[j][0]+'" target="'+cou_cnts[j][0]+'">'+cou_cnts[j][0]+'</a></td>');
       document.write('<td align="right"><font color="blue">'+(['&emsp;','&emsp;&emsp;'])[cn_ind]+cou_cnts[j][1].toString()+'</font></td>');
    }else if(j<cou_cnts.length+1){
       document.write('<td><small>&emsp;</small></td><td></td>');
    }else if(j<cou_cnts.length+2){
       document.write('<td align="left">'+mytext((['Total <a href="stat.html?chinese" style="text-decoration:none;color:'+fcol1+'">Chinese</a> Hanzi','汉字总数'])[cn_ind]+':&emsp;',fcol1)+'</td><td align="right">'+mytext(tmp1.length.toString(),fcol2)+'</td>');
    }else if(j<cou_cnts.length+py_cnts.length+2){
       fcolor1 = '<td align="left"><font color="'+(['red','orange','blue'])[Math.min(2,py_cnts[j-cou_cnts.length-2][1])]+'">';
       fcolor2 = '<td align="right"><font color="'+(['red','orange','blue'])[Math.min(2,py_cnts[j-cou_cnts.length-2][1])]+'">';
       txcol2  = ' style="text-decoration:none; color: '+(['red','orange','blue'])[Math.min(2,py_cnts[j-cou_cnts.length-2][1])]+'">';
       if (py_cnts[j-cou_cnts.length-2][1]>0) {
          pys = '<a href="https://ymqui.github.io/zhaopian/birds/showbird.html?order&hanzi='+py_cnts[j-cou_cnts.length-2][0]+'" target="'+loc_cnts[i][0]+'"'+txcol2+py_cnts[j-cou_cnts.length-2][0]+'</a>';
       }else{
          pys = py_cnts[j-cou_cnts.length-2][0];
       }
       for (var l=1;l<clen;l++){
           if (j==py_cnts.length+cou_cnts.length+1){break;}
           if (py_cnts[j-cou_cnts.length-1][1]==py_cnts[j-cou_cnts.length-2][1]){
              j++;
              if (py_cnts[j-cou_cnts.length-2][1]>0) {
                 pys = pys+'<a href="https://ymqui.github.io/zhaopian/birds/showbird.html?order&hanzi='+py_cnts[j-cou_cnts.length-2][0]+'" target="'+loc_cnts[i][0]+'"'+txcol2+py_cnts[j-cou_cnts.length-2][0]+'</a>';
              }else{
                 pys = pys+py_cnts[j-cou_cnts.length-2][0];
              }
           }else{break;}
       }
       document.write(fcolor1+pys+'</font></td>'+fcolor2+py_cnts[j-cou_cnts.length-2][1].toString()+'</font></td>');
    }else{
       document.write('<td></td><td></td>');
    }
    j++;
    document.write('<td></td>');
    if (k<(links.length*2-1)){
       if (k%2==0){
          tmp_url = '<img src="'+icons[k/2]+'" style="width:17px;height:auto;position:relative;top:4px;">&nbsp;'+links[k/2];
       }else{
          tmp_url = '';
       }
       document.write('<td colspan="3" align="left">'+tmp_url+'</td>');   
    }else{
       document.write('<td></td><td></td><td>&emsp;&emsp;</td>'); 
    }
    k++;
    document.write('</tr>');
}
document.write('</table>');
//-->
</script>
</body>
</html>